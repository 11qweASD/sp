<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>荣耀</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    .video-list {
      height: 100vh;
      overflow-y: scroll;
      scroll-snap-type: y mandatory;
      -webkit-overflow-scrolling: touch;
    }
    .video-item {
      scroll-snap-align: start;
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .controls {
      position: absolute;
      right: 10px;
      bottom: 20%;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 10;
    }
    .controls button, .controls select {
      background: rgba(0,0,0,0.5);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 6px;
      font-size: 12px;
      cursor: pointer;
    }
    /* 新增隐藏样式 */
    .hidden-control {
      display: none;
    }
  </style>
</head>
<body>
  <div class="video-list" id="videoList"></div>
  <script>
    const container = document.getElementById("videoList");
    const sources = [
      "https://www.cunshao.com/666666/api/pc.php",
      "http://api.yujn.cn/api/zzxjj.php",  // 修改为默认线路
      "https://jx.iqfk.top/api/sjsp.php",
      "https://www.cunshao.com/666666/api/web.php",
      "https://api.qoc.cc/api/xjj",
      "http://v.nrzj.vip/video.php"
    ];
    let defaultLine = localStorage.getItem('selectedLine') || sources[1];  // 从本地存储获取或使用线路1
    let currentIndex = 0;
    let videoElements = [];
    let autoPlay = true;  // 添加连续播放开关状态

    function createVideo(index, autoplay=false) {
      const wrapper = document.createElement("div");
      wrapper.className = "video-item";

      const video = document.createElement("video");
      video.src = defaultLine + "?_t=" + Math.random() + "&quality=1080";
      video.setAttribute("playsinline", "");
      video.setAttribute("webkit-playsinline", "");
      video.setAttribute("x5-video-player-type", "h5");
      video.setAttribute("x5-video-player-fullscreen", "true");
      video.controls = false;
      video.muted = false;
      if (autoplay) video.autoplay = true;

      const controls = document.createElement("div");
      controls.className = "controls";

      // 添加连续播放开关
      const autoPlayBtn = document.createElement("button");
      autoPlayBtn.textContent = autoPlay ? "连续: 开" : "连续: 关";
      autoPlayBtn.onclick = () => {
        autoPlay = !autoPlay;
        autoPlayBtn.textContent = autoPlay ? "连续: 开" : "连续: 关";
      };

      const playBtn = document.createElement("button");
      playBtn.textContent = "暂停";
      playBtn.onclick = () => {
        if (video.paused) {
          video.play();
          playBtn.textContent = "暂停";
        } else {
          video.pause();
          playBtn.textContent = "播放";
        }
      };

      const nextBtn = document.createElement("button");
      nextBtn.textContent = "下一个";
      nextBtn.onclick = () => {
        if (currentIndex < videoElements.length - 1) scrollTo(currentIndex + 1);
      };

      const select = document.createElement("select");
      select.classList.add("hidden-control"); // 隐藏线路选择器
      sources.forEach((src, i) => {
        const opt = document.createElement("option");
        opt.value = src;
        opt.textContent = "线路" + i;
        if (src === defaultLine) opt.selected = true;
        select.appendChild(opt);
      });
      select.onchange = () => {
        defaultLine = select.value;
        localStorage.setItem('selectedLine', defaultLine);  // 保存选择的线路到本地存储
        video.src = defaultLine + "?_t=" + Math.random() + "&quality=1080";
        video.play();
      };

      // 添加画质选择器
      const qualitySelect = document.createElement("select");
      qualitySelect.classList.add("hidden-control"); // 隐藏画质选择器
      const qualities = [
        {value: "480", text: "标清480P"},
        {value: "720", text: "高清720P"},
        {value: "1080", text: "超清1080P"}
      ];
      qualities.forEach(q => {
        const opt = document.createElement("option");
        opt.value = q.value;
        opt.textContent = q.text;
        if (q.value === "1080") opt.selected = true;
        qualitySelect.appendChild(opt);
      });
      qualitySelect.onchange = () => {
        const url = new URL(video.src);
        url.searchParams.set("quality", qualitySelect.value);
        video.src = url.toString();
        video.play();
      };

      // 视频结束自动播放下一个
      video.onended = () => {
        if (autoPlay) {
          video.src = defaultLine + "?_t=" + Math.random() + "&quality=1080";
          video.play();
        }
      };

      controls.appendChild(autoPlayBtn);
      controls.appendChild(playBtn);
      controls.appendChild(nextBtn);
      controls.appendChild(select);
      controls.appendChild(qualitySelect);
      wrapper.appendChild(video);
      wrapper.appendChild(controls);
      container.appendChild(wrapper);
      videoElements.push(video);
    }

    function scrollTo(index) {
      if (index >= 0 && index < videoElements.length) {
        videoElements[currentIndex].pause();
        videoElements[index].scrollIntoView({ behavior: "smooth" });
        videoElements[index].play();
        currentIndex = index;

        // 无限加载，没有100个限制
        if (index + 3 >= videoElements.length) {
          createVideo(false);
        }
      }
    }

    function preloadVideos(count) {
      for (let i = 0; i < count; i++) createVideo(i === 0);
    }

    container.addEventListener("scroll", () => {
      const items = document.querySelectorAll(".video-item");
      items.forEach((item, i) => {
        const rect = item.getBoundingClientRect();
        if (rect.top >= 0 && rect.top < window.innerHeight / 2) {
          if (i !== currentIndex) {
            videoElements[currentIndex].pause();
            videoElements[i].play();
            currentIndex = i;

            // 无限加载，没有100个限制
            if (i + 3 >= videoElements.length) {
              createVideo(false);
            }
          }
        }
      });
    });

    preloadVideos(9); // 预缓存9个
  </script>
</body>
</html>
